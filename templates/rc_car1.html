<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" href="#">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC_Car1!</title>
</head>
<body>
    Car will appear here!
    <div id="videos">
        <video class='video-player' id="local_video" autoplay playsinline></video>
        <video class='video-player' id="remote_video" autoplay playsinline></video>
    </div>
</body>
<script type="module" src="../static/vehicle_page.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"></script>

<script>
    // Connect to the server on the car
    const direction_socket_server = io('https://plntry33.ngrok.io');
    // const direction_socket_server = io('https://4ad8-136-24-55-174.ngrok.io');


    direction_socket_server.on('connect', function() {
      console.log('Connected to server 1');
    });

    direction_socket_server.on('disconnect', function() {
      console.log('Disconnected');
    });

    direction_socket_server.on('server_message', function(message){
        console.log("Message from Server: ", message)
    })

    // Create a heartbeat
    setInterval(function(){
        direction_socket_server.emit('heartbeat')
        // console.log("Heartbeat")
    }, 500)

    function moveVehicle(direction) {
      direction_socket_server.emit('move_command', {data: direction})
      console.log("Move command: ", direction)
      }

    document.addEventListener('keydown', (e) => {
      // One of the below two functions prevents repeated POST requests from going through
      if (e.repeat) return;

      if (event.defaultPrevented) {
          return;
      };
      switch (event.key){
          case "ArrowUp":
              moveVehicle("FORWARD")
              break;
          case "ArrowDown":
              moveVehicle("BACK")
              break;
          case "ArrowLeft":
              moveVehicle("LEFT")
              break;
          case "ArrowRight":
              moveVehicle("RIGHT")
              break;
          case "Spacebar":
              moveVehicle("STOP")
              break;
          default:
              return;
      }
        event.preventDefault();
    }, true);
  
    window.addEventListener('keyup', function (event) {
        if (event.defaultPrevented) {
            return;
        };
        moveVehicle("STOP")

        event.preventDefault();
    }, true)
  
  </script>
</html>